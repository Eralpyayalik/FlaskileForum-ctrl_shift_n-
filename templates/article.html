{% extends "layout.html" %}

{% block body %}
{% if article %}
<div class="container mt-4">
    <div class="row">
        <div class="col-lg-9">
            <div class="card shadow-sm mb-4 border-0">
                <div class="card-header bg-white border-bottom-0 pt-4">
                    <h2 class="font-weight-bold text-dark">{{article.title}}</h2>
                    <hr class="border-danger" style="width: 50px; margin-left: 0; border-width: 3px;">
                    <small class="text-muted">
                        <i class="fa fa-calendar-alt"></i> {{article.created_date}}
                    </small>
                </div>
                <div class="card-body" style="font-size: 1.1rem; line-height: 1.8;">
                    {{article.content | safe}}
                </div>
            </div>

            <div class="mb-4 mt-5">
                <h4 class="font-weight-bold">
                    <i class="fa fa-comments text-danger"></i> Yorumlar ({{comments|length if comments else 0}})
                </h4>
                <hr>
            </div>

            {% if comments %}
                {% for c in comments %}
                <div class="card mb-3 border-0 shadow-sm" style="border-left: 5px solid #dc3545 !important;">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <a href="/profile/{{ c.username }}" class="text-decoration-none">
                                <strong class="text-dark">@{{ c.username }}</strong>
                            </a>
                            <small class="text-muted">{{ c.created_date }}</small>
                        </div>
                        <p class="mt-2 mb-0 text-secondary">{{ c.comment }}</p>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="alert alert-light text-center border py-4">
                    <p class="mb-0 text-muted">Burası biraz sessiz... İlk yorumu sen yapmaya ne dersin?</p>
                </div>
            {% endif %}

            <div class="card shadow-sm mt-5 border-0 bg-light">
                <div class="card-body p-4">
                    {% if session.logged_in %}
                        <h5 class="font-weight-bold mb-3">Fikrini Belirt</h5>
                        <form method="POST" action="/add_comment/{{ article.id }}">
                            <textarea name="comment" class="form-control border-0 shadow-sm" rows="3" placeholder="Mesajınızı buraya yazın..." required></textarea>
                            <button type="submit" class="btn btn-danger mt-3 px-5 rounded-pill shadow-sm">Gönder</button>
                        </form>
                    {% else %}
                        <div class="alert alert-warning mb-0 text-center">
                            Yorum yapmak için <a href="/login" class="alert-link font-weight-bold">giriş yapmalısın</a>.
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="col-lg-3">
            <div class="card shadow border-0 text-center mb-4 overflow-hidden" style="border-radius: 15px;">
                <div class="bg-dark" style="height: 60px;"></div>
                <div class="card-body" style="margin-top: -45px;">
                    <div class="mb-3">
                        {% if article.avatar %}
                            <img src="{{ url_for('static', filename='avatars/' ~ article.avatar) }}" 
                                 class="rounded-circle img-thumbnail shadow-sm" 
                                 style="width: 100px; height: 100px; object-fit: cover; border: 4px solid white;">
                        {% else %}
                            <i class="fa fa-user-circle fa-5x text-white bg-secondary rounded-circle shadow" style="border: 4px solid white;"></i>
                        {% endif %}
                    </div>
                    
                    <h5 class="font-weight-bold mb-0 text-dark">{{article.name}}</h5>
                    <p class="text-muted small mb-3">@{{article.author}}</p>
                    
                    <div class="text-left small bg-light p-2 rounded mb-3 border">
                        <div class="mb-1 text-truncate">
                            <i class="fa fa-envelope text-danger mr-1"></i> {{article.email}}
                        </div>
                    </div>

                    <a href="/profile/{{article.author}}" class="btn btn-outline-danger btn-sm btn-block rounded-pill">
                        Profiline Git
                    </a>
                </div>
            </div>
            
            <div class="card shadow-sm border-0 p-3 bg-white text-dark rounded border-left border-danger" style="border-left-width: 5px !important;">
                <small class="text-muted font-italic">"Tartışmalarda saygılı olmayı unutmayın, burası nezih bir ortam (yani umarız)."</small>
            </div>
        </div>
    </div>
</div>
{% else %}
<div class="container mt-5">
    <div class="alert alert-danger shadow border-0">
        <i class="fa fa-exclamation-triangle mr-2"></i> Böyle bir konu bulunamadı veya silinmiş olabilir.
    </div>
</div>
{% endif %}
{% endblock body %}